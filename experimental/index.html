<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Lista de Trocas do Tony</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <h1 class="text-3xl font-bold mb-6 text-center">Lista de Trocas do Tony</h1>
  
  <div class="grid grid-cols-2 gap-8">
    <!-- Selling/Trading -->
    <div>
      <h2 class="text-xl font-semibold mb-2">Tenho</h2>
      <input id="selling-search" type="text" placeholder="Pesquisar..." class="w-full mb-2 border p-1 rounded text-sm">
      <div class="flex items-center gap-2 mb-2">
        <label>Ordenar por:</label>
        <select id="selling-sort" class="border rounded p-1 text-sm"></select>
        <button id="selling-order" class="bg-gray-200 px-2 rounded text-sm">Ascendente</button>
      </div>
      <div id="selling-list" class="grid gap-4 h-[70vh] overflow-y-auto"></div>
    </div>
    
    <!-- Looking For -->
    <div>
      <h2 class="text-xl font-semibold mb-2">Quero</h2>
      <input id="wanted-search" type="text" placeholder="Pesquisar..." class="w-full mb-2 border p-1 rounded text-sm">
      <div class="flex items-center gap-2 mb-2">
        <label>Ordenar por:</label>
        <select id="wanted-sort" class="border rounded p-1 text-sm"></select>
        <button id="wanted-order" class="bg-gray-200 px-2 rounded text-sm">Ascendente</button>
      </div>
      <div id="wanted-list" class="grid gap-4 h-[70vh] overflow-y-auto"></div>
    </div>
  </div>

  <!-- Card Details Modal -->
  <div id="card-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 max-w-lg w-full relative">
      <button id="modal-close" class="absolute top-2 right-2 text-gray-600 hover:text-black">&times;</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQpJVCUhWxyH_TM4-83ra9FXLCES8yqIBVQy3ed6OoVZwbSH4LkoVh7gBn6K2iz32cQNftsj1E-UIiK/pub?output=csv";

    let sellingCards = [];
    let wantedCards = [];

    // ---------- Helpers ----------
    async function loadCsv(url) {
      return new Promise((resolve, reject) => {
        Papa.parse(url, {
          download: true,
          header: true,
          skipEmptyLines: true,
          complete: results => resolve(results.data),
          error: err => reject(err)
        });
      });
    }

    function createCardElement(card) {
      if (!card.name) return null;
      let image = "";
      if (card.passcode) {
        const code = card.passcode.replace(/^0+/, "");
        image = `https://images.ygoprodeck.com/images/cards/${code}.jpg`;
      }
      if (card.customImage) image = card.customImage;

      const div = document.createElement("div");
      div.className = "bg-white rounded-xl shadow-md p-3 flex gap-3 items-center cursor-pointer";
      div.innerHTML = `
        <img src="${image}" alt="${card.name}" class="w-20 h-28 object-cover rounded">
        <div>
          <h4 class="font-bold">${card.name}</h4>
          ${card.setid ? `<p class="text-sm text-gray-600">Número: ${card.setid}</p>` : ""}
          ${card.passcode ? `<p class="text-sm text-gray-600">Código: ${card.passcode}</p>` : ""}
          ${card.price ? `<p class="text-sm text-green-600">R$ ${card.price}</p>` : ""}
